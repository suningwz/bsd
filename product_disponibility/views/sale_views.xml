<odoo>
    <data>
        <record id="view_order_form" model ="ir.ui.view">
        <field name="name">sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <field name="partner_shipping_id" position="after">
                <field name="date_disponibility" attrs="{'readonly': [('state', 'in', ['sale','done','cancel'])]}"/>
            </field>

            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='product_uom_qty']" position="after">
                <field name="date_disponibility" readonly="False"/>
            </xpath>

            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='name']" position="before">
                <field name="product_image" widget="image" options="{'size': [30, 30]}" class="oe_avatar"/>
            </xpath>

            <xpath expr="//field[@name='order_line']/form" position="replace">
              <form>
                <field name="display_type" invisible="1"/>
                <!--
                    We need the sequence field to be here for new lines to be added at the correct position.
                    TODO: at some point we want to fix this in the framework so that an invisible field is not required.
                -->
                <field name="sequence" invisible="1"/>
                <group>
                    <group attrs="{'invisible': [('display_type', '!=', False)]}">
                        <field name="product_updatable" invisible="1"/>
                        <field name="product_id" context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}" attrs="{                                                     'readonly': [('product_updatable', '=', False)],                                                     'required': [('display_type', '=', False)],                                                 }" force_save="1"/>
                        <field name="invoice_status" invisible="1"/>
                        <field name="qty_to_invoice" invisible="1"/>
                        <field name="qty_delivered_manual" invisible="1"/>
                        <field name="qty_delivered_method" invisible="1"/>
                        <field name="price_total" invisible="1"/>
                        <field name="price_tax" invisible="1"/>
                        <field name="price_subtotal" invisible="1"/>
                        <label for="product_uom_qty" string="Ordered Quantity"/>
                        <div>
                            <field context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}" name="product_uom_qty" class="oe_inline"/>
                            <field name="product_uom" force_save="1" groups="uom.group_uom" class="oe_inline oe_no_button" attrs="{                                                         'readonly': [('state', 'in', ('sale', 'done', 'cancel'))],                                                         'required': [('display_type', '=', False)],                                                     }"/>
                        </div>
                        <label for="qty_delivered" string="Delivered Quantity" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                        <div attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                            <field name="qty_delivered" attrs="{'readonly': [('qty_delivered_method', '!=', 'manual')]}"/>
                        </div>
                        <label for="qty_invoiced" string="Invoiced Quantity" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                        <div attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                            <field name="qty_invoiced" attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                        </div>
                        <field name="price_unit"/>
                        <label for="discount" groups="sale.group_discount_per_so_line"/>
                        <div name="discount" groups="sale.group_discount_per_so_line">
                            <field name="discount" class="oe_inline"/> %
                        </div>
                        <field name="tax_id" widget="many2many_tags" options="{'no_create': True}" context="{'search_view_ref': 'account.account_tax_view_search'}" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]" attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                        <label for="customer_lead"/>
                        <div>
                            <field name="customer_lead" class="oe_inline"/> days
                        </div>
                        <label for="analytic_tag_ids" groups="analytic.group_analytic_tags"/>
                        <div>
                            <field name="analytic_tag_ids" widget="many2many_tags" groups="analytic.group_analytic_tags" options="{'color_field': 'color'}"/>
                        </div>
                        <label for="date_disponibility" string="Date de mise à disposition Estimée"/>
                        <div>
                            <field name="date_disponibility" readonly="False"/>
                        </div>
                        <!--
                            We need the sequence field to be here
                            because we want to be able to overwrite the default sequence value in the JS
                            in order for new lines to be added at the correct position.
                            NOTE: at some point we want to fix this in the framework so that an invisible field is not required.
                        -->
                        <field name="sequence" invisible="1"/>
                    </group>
                    <group attrs="{'invisible': [('display_type', '!=', False)]}">
                      <div>
                        <field name="product_image" widget="image"/>
                      </div>
                    </group>
                </group>
                <label for="name" string="Description" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                <label for="name" string="Section Name (eg. Products, Services)" attrs="{'invisible': [('display_type', '!=', 'line_section')]}"/>
                <label for="name" string="Note" attrs="{'invisible': [('display_type', '!=', 'line_note')]}"/>
                <field name="name"/>
                <div groups="base.group_no_one" attrs="{'invisible': [('display_type', '!=', False)]}">
                    <label for="invoice_lines"/>
                    <field name="invoice_lines"/>
                </div>
                <field name="state" invisible="1"/>
              </form>
            </xpath>
        </field>
        </record>

        <record id="view_order_tree" model ="ir.ui.view">
        <field name="name">sale.order.tree</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree" />
        <field name="arch" type="xml">
            <field name="commitment_date" position="replace">
                <field name="commitment_date" invisible="1"/>
            </field>

            <field name="expected_date" position="replace">
                <field name="expected_date" invisible="1"/>
            </field>

            <field name="confirmation_date" position="after">
                <field name="date_disponibility"/>
            </field>
        </field>
        </record>

        <record id="view_quotation_tree" model ="ir.ui.view">
        <field name="name">sale.quot.tree</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree" />
        <field name="arch" type="xml">
            <field name="commitment_date" position="replace">
                <field name="commitment_date" invisible="1"/>
            </field>

            <field name="expected_date" position="replace">
                <field name="expected_date" invisible="1"/>
            </field>

            <field name="date_order" position="after">
                <field name="date_disponibility"/>
            </field>
        </field>
        </record>
    </data>
</odoo>
